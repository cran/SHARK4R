<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Quality Control of SHARK Data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Quality Control of SHARK Data</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The SHARK4R package provides a set of functions to perform quality
control (QC) on SHARK data. These functions help identify missing or
invalid values, spatial errors, and statistical outliers and are mainly
intended for internal data validation. The tutorial covers:</p>
<ul>
<li><strong>Field validation</strong> (required and datatype-specific
fields)<br />
</li>
<li><strong>Code validation</strong> (project and platform codes)<br />
</li>
<li><strong>Geospatial checks</strong> (points on land, basins,
proximity to shore)<br />
</li>
<li><strong>Depth checks</strong> (missing, negative, or implausible
values)<br />
</li>
<li><strong>Outlier detection</strong> (parameter-specific
thresholds)<br />
</li>
<li><strong>Logical Parameter Checks</strong> (parameter-specific
rules)<br />
</li>
<li><strong>Interactive QC</strong> with a Shiny app</li>
</ul>
<p>This workflow ensures SHARK data are consistent, valid, and ready for
analysis. Several quality control components, originally developed by
Provoost and Bosch (2018), have been adapted for compatibility with the
SHARK format.</p>
<hr />
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the latest version of <code>SHARK4R</code> from CRAN
using:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;SHARK4R&quot;</span>)</span></code></pre></div>
<p>Load the package along with <code>dplyr</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(SHARK4R)</span></code></pre></div>
<hr />
</div>
<div id="retrieve-shark-data" class="section level2">
<h2>Retrieve SHARK Data</h2>
<p>You can fetch SHARK data using the same filtering options as the
SHARK web interface. Explore available options with:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>shark_options <span class="ot">&lt;-</span> <span class="fu">get_shark_options</span>()</span></code></pre></div>
<p>Filter datasets containing “Chlorophyll”:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Filter names using grepl</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>chlorophyll_datasets <span class="ot">&lt;-</span> shark_options<span class="sc">$</span>datasets[<span class="fu">grepl</span>(<span class="st">&quot;Chlorophyll&quot;</span>, </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                                                     shark_options<span class="sc">$</span>datasets)]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Select the first dataset for demonstration</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>selected_dataset <span class="ot">&lt;-</span> chlorophyll_datasets[<span class="dv">1</span>]</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># Print the name of the selected dataset</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="fu">print</span>(selected_dataset)</span></code></pre></div>
<pre><code>## [1] &quot;SHARK_Chlorophyll_1985_1989_SMHI_version_2023-04-27.zip&quot;</code></pre>
<p>Download the selected dataset as a data frame:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>chlorophyll_data <span class="ot">&lt;-</span> <span class="fu">get_shark_datasets</span>(selected_dataset,</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                                       <span class="at">save_dir =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                                       <span class="at">return_df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                                       <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">print</span>(chlorophyll_data)</span></code></pre></div>
<pre><code>## # A tibble: 80 × 73
##    source delivery_datatype check_status_sv data_checked_by_sv visit_year
##     &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;                   &lt;dbl&gt;
##  1      1 Chlorophyll       Klar            Leverantör               1989
##  2      1 Chlorophyll       Klar            Leverantör               1989
##  3      1 Chlorophyll       Klar            Leverantör               1985
##  4      1 Chlorophyll       Klar            Leverantör               1989
##  5      1 Chlorophyll       Klar            Leverantör               1989
##  6      1 Chlorophyll       Klar            Leverantör               1989
##  7      1 Chlorophyll       Klar            Leverantör               1989
##  8      1 Chlorophyll       Klar            Leverantör               1989
##  9      1 Chlorophyll       Klar            Leverantör               1989
## 10      1 Chlorophyll       Klar            Leverantör               1989
## # ℹ 70 more rows
## # ℹ 68 more variables: visit_month &lt;dbl&gt;, station_name &lt;chr&gt;,
## #   reported_station_name &lt;chr&gt;, sample_location_id &lt;dbl&gt;, station_id &lt;dbl&gt;,
## #   sample_project_name_en &lt;chr&gt;, sample_orderer_name_en &lt;chr&gt;,
## #   platform_code &lt;chr&gt;, visit_id &lt;dbl&gt;, expedition_id &lt;lgl&gt;,
## #   shark_sample_id_md5 &lt;chr&gt;, sample_date &lt;date&gt;, sample_time &lt;time&gt;,
## #   sample_enddate &lt;lgl&gt;, sample_endtime &lt;lgl&gt;, sample_latitude_dm &lt;chr&gt;, …</code></pre>
<p>SHARK data can be downloaded and saved locally using the
<code>save_dir</code> argument, then imported into R using the function
<code>read_shark()</code> for both ZIP archives or text files.</p>
<hr />
</div>
<div id="step-1-check-required-fields" class="section level2">
<h2>Step 1: Check Required Fields</h2>
<p>Validate mandatory fields:</p>
<ul>
<li><strong>Global fields</strong>: <code>check_datatype()</code><br />
</li>
<li><strong>Datatype-specific fields</strong>:
<code>check_fields()</code> with optional
<code>field_definitions</code></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">check_fields</span>(<span class="at">data =</span> chlorophyll_data, <span class="at">datatype =</span> <span class="st">&quot;Chlorophyll&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,195 × 4
##    level field                           row message                            
##    &lt;chr&gt; &lt;chr&gt;                         &lt;int&gt; &lt;chr&gt;                              
##  1 error sample_project_name_sv           NA Required field sample_project_name…
##  2 error sample_orderer_name_sv           NA Required field sample_orderer_name…
##  3 error sampling_laboratory_name_sv      NA Required field sampling_laboratory…
##  4 error analytical_laboratory_name_sv    NA Required field analytical_laborato…
##  5 error reporting_institute_name_sv      NA Required field reporting_institute…
##  6 error sample_enddate                    1 Empty value for required field sam…
##  7 error sample_enddate                    2 Empty value for required field sam…
##  8 error sample_enddate                    3 Empty value for required field sam…
##  9 error sample_enddate                    4 Empty value for required field sam…
## 10 error sample_enddate                    5 Empty value for required field sam…
## # ℹ 1,185 more rows</code></pre>
<hr />
</div>
<div id="step-2-validate-project-and-platform-codes" class="section level2">
<h2>Step 2: Validate Project and Platform Codes</h2>
<p>Ensure metadata codes follow SHARK conventions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Validate project codes</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">check_codes</span>(chlorophyll_data)</span></code></pre></div>
<pre><code>## All PROJ codes found</code></pre>
<pre><code>## # A tibble: 1 × 2
##   reported_code              match_type
##   &lt;chr&gt;                      &lt;lgl&gt;     
## 1 National marine monitoring TRUE</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Validate ship/platform codes</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">check_codes</span>(<span class="at">data =</span> chlorophyll_data, </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>            <span class="at">field =</span> <span class="st">&quot;platform_code&quot;</span>, </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>            <span class="at">code_type =</span> <span class="st">&quot;SHIPC&quot;</span>, </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>            <span class="at">match_column =</span> <span class="st">&quot;Code&quot;</span>)</span></code></pre></div>
<pre><code>## All SHIPC codes found</code></pre>
<pre><code>## # A tibble: 2 × 2
##   reported_code match_type
##   &lt;chr&gt;         &lt;lgl&gt;     
## 1 77AR          TRUE      
## 2 77SN          TRUE</code></pre>
<hr />
</div>
<div id="step-3-geospatial-checks" class="section level2">
<h2>Step 3: Geospatial Checks</h2>
<div id="visualize-data-points" class="section level3">
<h3>Visualize Data Points</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">plot_map_leaflet</span>(chlorophyll_data)</span></code></pre></div>
<pre><code>## The interactive map is omitted here but appears in the online tutorial.</code></pre>
</div>
<div id="identify-points-on-land" class="section level3">
<h3>Identify Points on Land</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>n_rows_on_land <span class="ot">&lt;-</span> <span class="fu">check_onland</span>(chlorophyll_data)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">nrow</span>(n_rows_on_land)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Optional geospatial QC functions:</p>
<ul>
<li><code>positions_are_near_land()</code><br />
</li>
<li><code>which_basin()</code> from the <a href="https://CRAN.R-project.org/package=iRfcb">iRfcb package</a></li>
</ul>
<hr />
</div>
</div>
<div id="step-4-depth-checks" class="section level2">
<h2>Step 4: Depth Checks</h2>
<p>Verify plausibility and consistency of depth values:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">check_depth</span>(<span class="at">data =</span> chlorophyll_data) <span class="co"># default columns: min/max depth</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   level     row field              message                                      
##   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                                        
## 1 warning    17 sample_max_depth_m Depth value (20) is greater than the value f…
## 2 warning    80 sample_max_depth_m Depth value (20) is greater than the value f…</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">check_depth</span>(<span class="at">data =</span> chlorophyll_data, <span class="st">&quot;water_depth_m&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 57 × 4
##    level     row field         message                                          
##    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;                                            
##  1 warning     2 water_depth_m Depth value (78) is greater than the value found…
##  2 warning     3 water_depth_m Depth value (78) is greater than the value found…
##  3 warning     4 water_depth_m Depth value (637) is greater than the value foun…
##  4 warning     6 water_depth_m Depth value (86) is greater than the value found…
##  5 warning     8 water_depth_m Depth value (25) is greater than the value found…
##  6 warning     9 water_depth_m Depth value (41) is greater than the value found…
##  7 warning    10 water_depth_m Depth value (90) is greater than the value found…
##  8 warning    11 water_depth_m Depth value (74) is greater than the value found…
##  9 warning    13 water_depth_m Depth value (465) is greater than the value foun…
## 10 warning    14 water_depth_m Depth value (465) is greater than the value foun…
## # ℹ 47 more rows</code></pre>
<p>Checks performed:</p>
<ul>
<li>Missing depth column or empty values (warnings)<br />
</li>
<li>Non-numeric or negative values (errors)<br />
</li>
<li>Depth exceeding bathymetry or minimum &gt; maximum (errors)</li>
</ul>
<hr />
</div>
<div id="step-5-outlier-detection" class="section level2">
<h2>Step 5: Outlier Detection</h2>
<p>Retrieve reference statistics for your datatype:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>shark_statistics <span class="ot">&lt;-</span> <span class="fu">get_shark_statistics</span>(<span class="at">datatype =</span> <span class="st">&quot;Chlorophyll&quot;</span>,</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>                                         <span class="at">fromYear =</span> <span class="dv">2020</span>,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>                                         <span class="at">toYear =</span> <span class="dv">2024</span>,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>                                         <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="fu">print</span>(shark_statistics)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 24
##   parameter  datatype fromYear toYear     n   min    Q1 median    Q3   max   P01
##   &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Chlorophy… Chlorop…     2020   2024  1374  0.19  1.39    2.2   3.3  22.2 0.307
## # ℹ 13 more variables: P05 &lt;dbl&gt;, P95 &lt;dbl&gt;, P99 &lt;dbl&gt;, IQR &lt;dbl&gt;, mean &lt;dbl&gt;,
## #   sd &lt;dbl&gt;, var &lt;dbl&gt;, cv &lt;dbl&gt;, mad &lt;dbl&gt;, mild_lower &lt;dbl&gt;,
## #   mild_upper &lt;dbl&gt;, extreme_lower &lt;dbl&gt;, extreme_upper &lt;dbl&gt;</code></pre>
<p>Detect extreme values using thresholds (e.g., 99th percentile):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">check_outliers</span>(<span class="at">data =</span> chlorophyll_data,</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>               <span class="at">parameter =</span> <span class="st">&quot;Chlorophyll-a&quot;</span>,</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>               <span class="at">datatype =</span> <span class="st">&quot;Chlorophyll&quot;</span>,</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>               <span class="at">threshold_col =</span> <span class="st">&quot;P99&quot;</span>,</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>               <span class="at">thresholds =</span> shark_statistics)</span></code></pre></div>
<pre><code>## Chlorophyll-a is within the P99 range.</code></pre>
<p>Visualize anomalies:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Scatterplot with horizontal line at 99th percentile</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">scatterplot</span>(chlorophyll_data,</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>            <span class="at">hline =</span> shark_statistics<span class="sc">$</span>P99)</span></code></pre></div>
<pre><code>## The interactive plot is omitted here but appears in the online tutorial.</code></pre>
<hr />
</div>
<div id="step-6-logical-parameter-checks" class="section level2">
<h2>Step 6: Logical Parameter Checks</h2>
<p>Use <code>check_parameter_rules()</code> to flag measurements that
violate parameter-specific or row-wise logical rules.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">check_parameter_rules</span>(<span class="at">data =</span> chlorophyll_data)</span></code></pre></div>
<pre><code>## No parameters from the logical rules are present in the dataset. Available parameters are: Total cover of all species, Cover, Cover class, Sediment deposition cover, Abundance class, Wet weight</code></pre>
<ul>
<li><code>return_df = TRUE</code> gives a data frame of violations.</li>
<li><code>return_logical = TRUE</code> gives logical vectors for each
parameter.</li>
<li>Only parameters present in the dataset are checked; available
parameters are listed if none match.</li>
<li>You can define custom rules by providing your own
<code>param_conditions</code> or <code>rowwise_conditions</code>
lists.</li>
</ul>
<hr />
</div>
<div id="step-7-station-matching" class="section level2">
<h2>Step 7: Station Matching</h2>
<p>Verify station names against the official SHARK registry:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>station_match <span class="ot">&lt;-</span> <span class="fu">match_station</span>(chlorophyll_data<span class="sc">$</span>station_name)</span></code></pre></div>
<pre><code>## Using station.txt from NODC_CONFIG: /home/anders/nodc_config//nodc_station/station.txt</code></pre>
<pre><code>## All stations found</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">head</span>(station_match)</span></code></pre></div>
<pre><code>##   reported_station_name match_type
## 1            425 GNIBEN       TRUE
## 2                FLADEN       TRUE
## 3                FLADEN       TRUE
## 4                    M6       TRUE
## 5              ANHOLT E       TRUE
## 6              W SKAGEN       TRUE</code></pre>
<p>To plot stations and their distances from the station register in an
interactive map:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">check_station_distance</span>(<span class="at">data =</span> chlorophyll_data,</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>                       <span class="at">plot_leaflet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## The interactive map is omitted here but appears in the online tutorial.</code></pre>
<p>To check if stations are nominal (comparing unique coordinates per
station):</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">check_nominal_station</span>(<span class="at">data =</span> chlorophyll_data)</span></code></pre></div>
<pre><code>## Positions are not suspected to be nominal</code></pre>
<hr />
</div>
<div id="interactive-qc-with-shiny" class="section level2">
<h2>Interactive QC with Shiny</h2>
<p>For a more user-friendly interface, use the Shiny QC app:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># Run the app</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="fu">run_qc_app</span>()</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="co"># Alternative, download support files and knit documents locally</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="fu">check_setup</span>(<span class="at">path =</span> <span class="fu">tempdir</span>()) <span class="co"># using a temp folder in this example</span></span></code></pre></div>
<p>The app provides point-and-click access to the same QC checks
described above.</p>
<hr />
</div>
<div id="recommended-workflow-summary" class="section level2">
<h2>Recommended Workflow Summary</h2>
<ol style="list-style-type: decimal">
<li><strong>Check Required Fields</strong>
(<code>check_datatype()</code>, <code>check_fields()</code>)<br />
</li>
<li><strong>Validate Codes</strong> (<code>check_codes()</code>)<br />
</li>
<li><strong>Geospatial Checks</strong> (<code>plot_map_leaflet()</code>,
<code>check_onland()</code>, optional
<code>positions_are_near_land()</code>,
<code>which_basin()</code>)<br />
</li>
<li><strong>Depth Checks</strong> (<code>check_depth()</code>)<br />
</li>
<li><strong>Outlier Detection</strong> (<code>check_outliers()</code>,
<code>scatterplot()</code>)<br />
</li>
<li><strong>Logical Parameter Checks</strong>
(<code>check_parameter_rules()</code>)<br />
</li>
<li><strong>Station Matching</strong>
(<code>match_station()</code>)<br />
</li>
<li><strong>Final Review &amp; Visualization</strong> (interactive maps
and scatterplots)</li>
</ol>
<p>Following this order ensures comprehensive QC and prepares your SHARK
data for analysis.</p>
<hr />
</div>
<div id="citation" class="section level2">
<h2>Citation</h2>
<pre><code>## To cite package &#39;SHARK4R&#39; in publications use:
## 
##   Lindh, M. and Torstensson, A. (2026). SHARK4R: Accessing and
##   Validating Marine Environmental Data from &#39;SHARK&#39; and Related
##   Databases. R package version 1.0.3.
##   https://CRAN.R-project.org/package=SHARK4R
## 
## A BibTeX entry for LaTeX users is
## 
##   @Manual{,
##     title = {SHARK4R: Accessing and Validating Marine Environmental Data from &#39;SHARK&#39; and Related Databases},
##     author = {Markus Lindh and Anders Torstensson},
##     year = {2026},
##     note = {R package version 1.0.3},
##     url = {https://CRAN.R-project.org/package=SHARK4R},
##   }</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li>Provoost P, Bosch S (2024). <code>obistools</code>: Tools for data
enhancement and quality control. Ocean Biodiversity Information System.
Intergovernmental Oceanographic Commission of UNESCO. R package version
0.1.0, <a href="https://iobis.github.io/obistools/" class="uri">https://iobis.github.io/obistools/</a>.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
